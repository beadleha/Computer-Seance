#pragma once

class Raquette: public Computer {
	public:
	// 7 processor status flags:
	bool flag_c, flag_z, flag_i, flag_d, flag_b, flag_v, flag_n;
	Color dispBuf[192][280];
	Raquette(uint8_t *init_contents = nullptr, int len_contents = 0);
	// TODO reset (for resetting regs and pc)
	std::tuple<int, int> aModeHelper(uint8_t thisbyte);
	uint8_t rolHelper(uint8_t byte);
	uint8_t rorHelper(uint8_t byte);
	void softSwitchesHelper(int eff_addr);
	void branchHelper();
	int step(bool verbose = false);
	void show_regs();
	void consoleSession();
	void renderScreen();

	// Rows are in reverse order
	const uint8_t charset[0x40*7] = {
	0x70,0x80,0xba,0xaa,0xba,0x8a,0x70, // @
	0x8a,0x8a,0x8a,0xfa,0x8a,0x8a,0x70, // A
	0xf0,0x8a,0x8a,0xf0,0x8a,0x8a,0xf0, // B
	0x70,0x8a,0x80,0x80,0x80,0x8a,0x70, // C
	0xf0,0x8a,0x8a,0x8a,0x8a,0x8a,0xf0, // D
	0xfa,0x80,0x80,0xf0,0x80,0x80,0xfa, // E
	0x80,0x80,0x80,0xf0,0x80,0x80,0xfa, // F
	0x70,0x8a,0x9a,0x80,0x80,0x8a,0x70, // G
	0x8a,0x8a,0x8a,0xfa,0x8a,0x8a,0x8a, // H
	0xfa,0x20,0x20,0x20,0x20,0x20,0xfa, // I
	0x70,0x8a,0x0a,0x0a,0x0a,0x0a,0x7a, // J
	0x8a,0x8a,0x90,0xe0,0x90,0x8a,0x8a, // K
	0xfa,0x80,0x80,0x80,0x80,0x80,0x80, // L
	0x8a,0x8a,0x8a,0x8a,0xaa,0xda,0x8a, // M
	0x8a,0x8a,0x9a,0xaa,0xca,0x8a,0x8a, // N
	0x70,0x8a,0x8a,0x8a,0x8a,0x8a,0x70, // O
	0x80,0x80,0x80,0xf0,0x8a,0x8a,0xf0, // P
	0x6a,0x90,0xaa,0x8a,0x8a,0x8a,0x70, // Q
	0x8a,0x8a,0x8a,0xf0,0x8a,0x8a,0xf0, // R
	0xf0,0x0a,0x0a,0x70,0x80,0x80,0x7a, // S
	0x20,0x20,0x20,0x20,0x20,0x20,0xfa, // T
	0x70,0x8a,0x8a,0x8a,0x8a,0x8a,0x8a, // U
	0x20,0x50,0x8a,0x8a,0x8a,0x8a,0x8a, // V
	0x8a,0xda,0xaa,0x8a,0x8a,0x8a,0x8a, // W
	0x8a,0x8a,0x50,0x20,0x50,0x8a,0x8a, // X
	0x20,0x20,0x20,0x20,0x50,0x8a,0x8a, // Y
	0xfa,0x80,0x40,0x20,0x10,0x0a,0xfa, // Z
	0x30,0x20,0x20,0x20,0x20,0x20,0x30, // [
	0x00,0x0a,0x10,0x20,0x40,0x80,0x00, // \ slash
	0x60,0x20,0x20,0x20,0x20,0x20,0x60, // ]
	0x00,0x00,0x00,0x00,0x8a,0x50,0x20, // ^
	0xfa,0x00,0x00,0x00,0x00,0x00,0x00, // _
	0x00,0x00,0x00,0x00,0x00,0x00,0x00, // (blank)
	0x20,0x00,0x20,0x20,0x20,0x20,0x20, // !
	0x00,0x00,0x00,0x00,0x00,0x50,0x50, // "
	0x50,0x50,0xfa,0x50,0xfa,0x50,0x50, // #
	0x20,0xf0,0x2a,0x70,0xa0,0x7a,0x20, // $
	0x1a,0x9a,0x40,0x20,0x10,0xca,0xc0, // %
	0x6a,0x90,0xfa,0x40,0xa0,0xa0,0x40, // &
	0x00,0x00,0x00,0x00,0x00,0x20,0x20, // '
	0x10,0x20,0x40,0x40,0x40,0x20,0x10, // (
	0x40,0x20,0x10,0x10,0x10,0x20,0x40, // )
	0x20,0xaa,0x70,0x20,0x70,0xaa,0x20, // *
	0x00,0x20,0x20,0xfa,0x20,0x20,0x00, // +
	0x40,0x20,0x20,0x00,0x00,0x00,0x00, // ,
	0x00,0x00,0x00,0xfa,0x00,0x00,0x00, // -
	0x20,0x00,0x00,0x00,0x00,0x00,0x00, // .
	0x00,0x80,0x40,0x20,0x10,0x0a,0x00, // /
	};
};
